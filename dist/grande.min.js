(function(){function a(){var a=M.createElement("div"),b="<div class='options'> \r\n          <span class='no-overflow'> \r\n            <span class='ui-inputs'> \r\n              <button class='bold'>B</button> \r\n              <button class='italic'>i</button> \r\n              <button class='header1'>h1</button> \r\n              <button class='header2'>h2</button> \r\n              <button class='quote'>&rdquo;</button> \r\n              <button class='url useicons'>&#xe001;</button> \r\n              <input class='url-input' type='text' placeholder='Paste or type a link'/> \r\n            </span> \r\n          </span> \r\n        </div>",c=M.createElement("div"),d=M.createElement("div");d.className="g-body",M.body.appendChild(d),c.innerHTML="<div class='pos-abs file-label'>Insert image</div> \r\n                                        <input class='file-hidden pos-abs' type='file' id='files' name='files[]' accept='image/*' multiple/>",c.className="image-tooltip hide",a.className="text-menu hide",a.innerHTML=b,0===M.querySelectorAll(".text-menu").length&&(d.appendChild(a),d.appendChild(c)),I=M.querySelectorAll(".file-label + input")[0],H=M.querySelectorAll(".image-tooltip")[0],D=M.querySelectorAll(".text-menu")[0],E=M.querySelectorAll(".text-menu .options")[0],F=M.querySelectorAll(".text-menu .url-input")[0]}function b(){var a,b,f;for(M.onmousedown=B,M.onmouseup=function(a){setTimeout(function(){B(a)},1)},M.onkeydown=l,M.onkeyup=function(a){var b=window.getSelection();b.anchorNode&&"ARTICLE"!==b.anchorNode.nodeName&&(m(a),b.isCollapsed&&q(a))},L.onresize=B,F.onblur=t,F.onkeydown=u,Q.allowImages&&(H.onmousedown=d,I.onchange=e,M.onmousemove=c),a=0,b=N.length;b>a;a++)f=N[a],f.contentEditable=!0,f.onmousedown=f.onkeyup=f.onmouseup=B}function c(a){f(a,a.target)}function d(a){var b=O.children,c=O.getBoundingClientRect();J=g(b,c,a)}function e(a){var b,c=this.files[0],d=new FileReader;d.onload=function(a){return function(a){b=M.createElement("figure"),b.innerHTML='<img src="'+a.target.result+'"/>',O.insertBefore(b,J.bottomElement)}}(c),d.readAsDataURL(c)}function f(a,b){var c=O.children,d=O.getBoundingClientRect(),e=g(c,d,a);e?(H.style.left=d.left-90+"px",H.style.top=e.top-17+"px"):(H.style.left=K+"px",H.style.top=K+"px")}function g(a,b,c){var d,e,f,g,h,i,j,k,l=[];for(e=0,f=a.length-1;f>e;e++)g=a[e],h=a[e+1]||null,i=g.getBoundingClientRect().bottom-5,j=h.getBoundingClientRect().top,l.push({top:j,bottom:i,topElement:g,bottomElement:h,index:e+1});for(k=c.pageY-L.scrollY,e=0,f=l.length;f>e;e++)if(d=l[e],k<d.top&&k>d.bottom)return d;return null}function h(a){var b,c,d,e=M.querySelectorAll(".text-menu button"),f=function(b){a(b)};for(b=0,c=e.length;c>b;b++)d=e[b],f(d)}function i(){h(function(a){a.onmousedown=function(b){s(a)}})}function j(){return L.getSelection().focusNode}function k(){var a,b,c,d=j();h(function(e){a=e.className;for(var f in tagClassMap)if(b=tagClassMap[f],c=new RegExp(b),c.test(a)){e.className=z(d,f)?b+" active":b;break}})}function l(a){var b,c=window.getSelection(),d=y(c.anchorNode,"p");13===a.keyCode&&d&&(prevSibling=d.previousSibling,b=prevSibling&&"HR"===prevSibling.nodeName&&!d.textContent.length,b&&a.preventDefault())}function m(a){var b,c=window.getSelection();13===a.keyCode&&("DIV"===c.anchorNode.nodeName&&v("p"),b=y(c.anchorNode,"p"),b&&n(b))}function n(a){var b,c,d;for(b=a.previousSibling,c=b;c&&c.nodeType==Node.TEXT_NODE;)c=c.previousSibling;"P"!==b.nodeName||b.textContent.length||"HR"===c.nodeName||(d=M.createElement("hr"),d.contentEditable=!1,a.parentNode.replaceChild(d,b))}function o(a){var b;return b=a.nodeType===Node.TEXT_NODE?"data":P?"textContent":"innerText"}function p(a,b,c){var d="ol"===c?"insertOrderedList":"insertUnorderedList",e="ol"===c?3:2;return M.execCommand(d),a.anchorNode[b]=a.anchorNode[b].substring(e),y(a.anchorNode,c)}function q(a){var b,c,d,e,f,g,h=window.getSelection();h.isCollapsed&&h.anchorNode&&"ARTICLE"!==h.anchorNode.nodeName&&(b=o(h.anchorNode),c=h.anchorNode[b],c.match(/^[-*]\s/)&&"LI"!==h.anchorNode.parentNode.nodeName&&(d=p(h,b,"ul")),c.match(/^1\.\s/)&&"LI"!==h.anchorNode.parentNode.nodeName&&(d=p(h,b,"ol")),e=d&&["ul","ol"].indexOf(d.nodeName.toLocaleLowerCase())>=0&&["p","div"].indexOf(d.parentNode.nodeName.toLocaleLowerCase())>=0,e&&(f=h.anchorNode,g=d.parentNode,g.parentNode.insertBefore(d,g),g.parentNode.removeChild(g),r(h,f)))}function r(a,b){range=M.createRange(),range.setStart(b,0),range.setEnd(b,0),a.removeAllRanges(),a.addRange(range)}function s(a){var b,c,d=a.className,e=window.getSelection(),f=e.anchorNode;for(var g in tagClassMap)if(b=tagClassMap[g],c=new RegExp(b),c.test(d))switch(g){case"b":return void(!f||z(f,"h1")||z(f,"h2")||M.execCommand(b,!1));case"i":return void M.execCommand(b,!1);case"h1":case"h2":case"h3":case"blockquote":return void v(g);case"a":return w(),void(E.className="options url-mode")}B()}function t(a){var b=F.value;return E.className="options",window.getSelection().addRange(G),M.execCommand("unlink",!1),""===b?!1:(b.match("^(http://|https://|mailto:)")||(b="http://"+b),M.execCommand("createLink",!1,b),void(F.value=""))}function u(a){13===a.keyCode&&(a.preventDefault(),a.stopPropagation(),F.blur())}function v(a){z(j(),a)?(M.execCommand("formatBlock",!1,"p"),M.execCommand("outdent")):M.execCommand("formatBlock",!1,a)}function w(){setTimeout(function(){var a=A(j());"undefined"!=typeof a?F.value=a:M.execCommand("createLink",!1,"/"),G=window.getSelection().getRangeAt(0),F.focus()},150)}function x(a,b,c){if(null!==a)for(;a.parentNode;){if(b(a))return c(a);a=a.parentNode}}function y(a,b){var c=function(a){return a.nodeName.toLowerCase()===b},d=function(a){return a};return x(a,c,d)}function z(a,b){return!!y(a,b)}function A(a){var b=function(a){return"undefined"!=typeof a.href},c=function(a){return a.href};return x(a,b,c)}function B(a){var b,c,d=L.getSelection(),e=a.target||a.srcElement;return e.isContentEditable?void(d.isCollapsed?(C(K,K),D.className="text-menu hide"):(b=d.getRangeAt(0),c=b.getBoundingClientRect(),k(),C(c.top-5+L.pageYOffset,(c.left+c.right)/2))):void k()}function C(a,b){D.style.top=a+"px",D.style.left=b+"px",Q.animate&&(D.className=a===K?"text-menu hide":"text-menu active")}var D,E,F,G,H,I,J,K=-999,L=this,M=this.document,N=M.querySelectorAll(".g-body article"),O=N[0],P=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,Q={animate:!0};grande={bind:function(c,d){c&&(N=c),Q=d||Q,a(),b(),i()},select:function(){B()}},tagClassMap={b:"bold",i:"italic",h1:"header1",h2:"header2",a:"url",blockquote:"quote"},L.grande=grande}).call(this);